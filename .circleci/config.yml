version: 2.1

jobs:
  beginning_the_workflow:
    docker:
      - image: cimg/base:2023.03
    steps:
      - run:
          name: Beginning the Workflow
          command: echo "Workflow started."

  finish_data_discovery:
    type: approval  # New approval step before finish_data_request

  finish_data_request:
    type: approval  # Requires approval after data discovery
    requires:
      - finish_data_discovery

  get_analyst_sign_off:
    type: approval
    requires:
      - finish_data_request

  all_done:
    docker:
      - image: cimg/base:2023.03
    steps:
      - run:
          name: All Done
          command: echo "Processing data..."

workflows:
  version: 2
  data_approval_workflow:
    jobs:
      - beginning_the_workflow:
          filters:
            branches:
              only:
                - main
      - finish_data_discovery:  # New approval step
          requires:
            - beginning_the_workflow
          filters:
            branches:
              only:
                - main
      - finish_data_request:  # Requires finish_data_discovery approval first
          requires:
            - finish_data_discovery
          filters:
            branches:
              only:
                - main
      - get_analyst_sign_off:
          requires:
            - finish_data_request
          filters:
            branches:
              only:
                - main
      - all_done:
          requires:
            - get_analyst_sign_off
          filters:
            branches:
              only:
                - main
